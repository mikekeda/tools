{% extends parent_template %}
{% load static from staticfiles %}
{% load i18n %}
{% load widget_tweaks %}

{% block content %}
    <!-- Button trigger modal -->
    <button type="button" class="add-event-btn btn btn-default btn-md" data-toggle="modal" data-target="#add-event">
      {% trans "Add event" %}
    </button>

    <!-- Modal -->
    <div class="modal" id="add-event" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="add-event-label">{% trans "Add event" %}</h4>
          </div>
          <div class="modal-body">
            <form action="{% url 'calendar' %}" method="post" class="add-event-form clearfix form-horizontal">
                {% csrf_token %}
                {% for field in form %}
                    <div class="form-group">
                        <label class="control-label col-sm-2">{{ field.label_tag }}</label>
                        <div class="col-sm-10">
                        {% if field.name == 'start' or field.name == 'end' %}
                            {{ field|add_class:"datetimepicker" }}
                        {% elif field.name == 'color_event' %}
                            {{ field|add_class:"jscolor" }}
                        {% else %}
                            {{ field }}
                        {% endif %}
                        </div>
                        {% if field.errors %}
                            <div class="alert alert-warning col-sm-10 pull-right" role="alert">
                              {{ field.errors }}
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
                <div class="modal-footer">
                  <button type="button" class="btn btn-default" data-dismiss="modal">{% trans "Close" %}</button>
                  <button type="submit" class="btn btn-primary btn-md pull-right">{% trans "Save" %}</button>
                </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div id="calendar"></div>
    <script type="text/javascript">
        if("undefined" == typeof jQuery) {
          window.onload = function() {
            init_app();
          };
        }
        else {
          init_app();
        }
        function init_app() {
            $('#calendar').fullCalendar({
                events: '/schedule/api/occurrences?calendar_slug={{ user.username }}',
                ignoreTimezone: false,
                timezone: 'local',
                timeFormat: 'H(:mm)',
                eventClick: function(calEvent, jsEvent, view) {
                    window.location.href = '/admin/schedule/event/' + calEvent.event_id + '/change/';
                },
                dayClick: function(date, jsEvent, view) {
                    $('#add-event').modal('show');
                },
                eventAfterRender: function (event, element) {
                    $(element).tooltip({
                        title:event.description,
                        container: "body"
                    });
                }
            });
        }
    </script>
{% endblock content %}
